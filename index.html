<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Hostel Mess Attendance</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #121212;
      color: #eee;
    }
    nav button {
      margin-right: 10px;
      padding: 8px 14px;
      border: none;
      border-radius: 6px;
      background: #1f1f1f;
      color: #eee;
      cursor: pointer;
    }
    nav button:hover {
      background: #333;
    }
    .hidden { display: none; }
    table {
      border-collapse: collapse;
      width: 100%;
      margin: 10px 0;
      background: #1e1e1e;
    }
    th, td {
      border: 1px solid #333;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #2a2a2a;
    }
    input, select, textarea {
      padding: 6px;
      margin: 4px 0;
      border-radius: 4px;
      border: 1px solid #444;
      background: #1a1a1a;
      color: #eee;
    }
    button.action {
      background: #007bff;
      color: #fff;
      border: none;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    button.action:hover {
      background: #0056b3;
    }
    .container { margin-top: 20px; }
    h2 { margin-top: 0; }
  </style>
</head>
<body>
  <h1>üè† Hostel Mess Attendance</h1>
  <nav>
    <button onclick="showSection('students')">üë• Students</button>
    <button onclick="showSection('attendance')">‚úÖ Attendance</button>
    <button onclick="showSection('reports')">üìä Reports</button>
    <button onclick="showSection('settings')">‚öôÔ∏è Settings</button>
  </nav>

  <!-- Students -->
  <div id="students" class="container">
    <h2>Student Management</h2>
    <input type="text" id="studentName" placeholder="Enter student name">
    <button class="action" onclick="addStudent()">Add Student</button>
    <table>
      <thead><tr><th>Name</th><th>Action</th></tr></thead>
      <tbody id="studentList"></tbody>
    </table>
  </div>

  <!-- Attendance -->
  <div id="attendance" class="container hidden">
    <h2>Mark Attendance</h2>
    <label>Select Student:</label>
    <select id="studentSelect"></select>
    <label>Date:</label>
    <input type="date" id="attendanceDate">
    <button class="action" onclick="markAttendance(true)">Present</button>
    <button class="action" onclick="markAttendance(false)">Absent</button>
    <table>
      <thead><tr><th>Name</th><th>Date</th><th>Status</th></tr></thead>
      <tbody id="attendanceList"></tbody>
    </table>
  </div>

  <!-- Reports -->
  <div id="reports" class="container hidden">
    <h2>Attendance Reports</h2>
    <label>Filter by Student:</label>
    <select id="reportStudentFilter" onchange="renderReports()"></select>
    <table>
      <thead><tr><th>Name</th><th>Date</th><th>Status</th></tr></thead>
      <tbody id="reportList"></tbody>
    </table>
  </div>

  <!-- Settings -->
  <div id="settings" class="container hidden">
    <h2>‚öôÔ∏è Settings</h2>
    <p>Paste your Firebase Config JSON below:</p>
    <textarea id="firebaseConfig" rows="8" style="width:100%;"></textarea><br>
    <button class="action" onclick="enableFirebase()">Enable Firebase Sync</button>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

  <script>
    let students = [];
    let attendance = [];
    let firebaseApp = null;
    let dbRef = null;

    // --- Local Storage Helpers ---
    function saveToLocal(){
      localStorage.setItem('students', JSON.stringify(students));
      localStorage.setItem('attendance', JSON.stringify(attendance));
    }
    function loadFromLocal(){
      students = JSON.parse(localStorage.getItem('students') || '[]');
      attendance = JSON.parse(localStorage.getItem('attendance') || '[]');
    }

    // --- Navigation ---
    function showSection(id){
      document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      if(id==='students') renderStudents();
      if(id==='attendance') renderAttendance();
      if(id==='reports') renderReports();
      if(id==='settings') {}
    }

    // --- Students ---
    function addStudent(){
      const name = document.getElementById('studentName').value.trim();
      if(!name) return alert("Enter student name");
      const s = {id: Date.now(), name};
      students.push(s);
      saveToLocal();
      renderStudents();
      populateStudentFilter();
      if(dbRef) dbRef.ref('students').set(students);
      document.getElementById('studentName').value="";
    }
    function deleteStudent(id){
      students = students.filter(s=>s.id!==id);
      saveToLocal();
      renderStudents();
      populateStudentFilter();
      if(dbRef) dbRef.ref('students').set(students);
    }
    function renderStudents(){
      const tbody = document.getElementById('studentList');
      tbody.innerHTML="";
      students.forEach(s=>{
        tbody.innerHTML+=`<tr><td>${s.name}</td>
          <td><button class="action" onclick="deleteStudent(${s.id})">Delete</button></td></tr>`;
      });
      populateStudentSelect();
    }

    // --- Attendance ---
    function populateStudentSelect(){
      const sel = document.getElementById('studentSelect');
      sel.innerHTML="";
      students.forEach(s=>{
        sel.innerHTML+=`<option value="${s.id}">${s.name}</option>`;
      });
    }
    function markAttendance(status){
      const sid = parseInt(document.getElementById('studentSelect').value);
      const date = document.getElementById('attendanceDate').value;
      if(!sid || !date) return alert("Select student and date");
      const s = students.find(st=>st.id===sid);
      const rec = {id: Date.now(), studentId: sid, name: s.name, date, status};
      attendance.push(rec);
      saveToLocal();
      renderAttendance();
      renderReports();
      if(dbRef) dbRef.ref('attendance').set(attendance);
    }
    function renderAttendance(){
      const tbody = document.getElementById('attendanceList');
      tbody.innerHTML="";
      attendance.forEach(a=>{
        tbody.innerHTML+=`<tr><td>${a.name}</td><td>${a.date}</td>
        <td>${a.status?'Present':'Absent'}</td></tr>`;
      });
    }

    // --- Reports ---
    function populateStudentFilter(){
      const sel = document.getElementById('reportStudentFilter');
      sel.innerHTML=`<option value="">All Students</option>`;
      students.forEach(s=>{
        sel.innerHTML+=`<option value="${s.id}">${s.name}</option>`;
      });
    }
    function renderReports(){
      const filter = document.getElementById('reportStudentFilter').value;
      const tbody = document.getElementById('reportList');
      tbody.innerHTML="";
      attendance.filter(a=>!filter || a.studentId==filter).forEach(a=>{
        tbody.innerHTML+=`<tr><td>${a.name}</td><td>${a.date}</td>
        <td>${a.status?'Present':'Absent'}</td></tr>`;
      });
    }

    // --- Firebase Sync ---
    function enableFirebase(){
      const cfgText = document.getElementById('firebaseConfig').value.trim();
      if(!cfgText) return alert('Paste Firebase config JSON first!');
      const cfg = JSON.parse(cfgText);

      firebaseApp = firebase.initializeApp(cfg);
      dbRef = firebase.database();

      // Push local data
      dbRef.ref('students').set(students);
      dbRef.ref('attendance').set(attendance);

      // Sync from cloud
      dbRef.ref('students').on('value', snap=>{
        const val = snap.val();
        if(val){ students = val; saveToLocal(); renderStudents(); populateStudentFilter(); }
      });
      dbRef.ref('attendance').on('value', snap=>{
        const val = snap.val();
        if(val){ attendance = val; saveToLocal(); renderAttendance(); renderReports(); }
      });

      alert("‚úÖ Firebase sync enabled!");
    }

    // Init
    loadFromLocal();
    renderStudents();
    renderAttendance();
    populateStudentFilter();
  </script>
</body>
</html>
